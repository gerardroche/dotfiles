#!/bin/sh

set -e
unset CDPATH
unset IFS

is_dev=
if test "x$1" = "x--dev"; then
    is_dev=true
    shift
fi

if test -f vendor/bin/php-cs-fixer; then
    php_cs_fixer_bin=vendor/bin/php-cs-fixer
elif test -f laravel/vendor/bin/php-cs-fixer; then
    php_cs_fixer_bin=laravel/vendor/bin/php-cs-fixer
else
    php_cs_fixer_bin="$(get_local_phpcsfixer_version_bin)"
    if test -z "$php_cs_fixer_bin"; then
        php_cs_fixer_bin=php-cs-fixer
    fi
fi

# echo "Using $php_cs_fixer_bin"
# echo "$("$php_cs_fixer_bin" --version)"

config_file=
if test -f ./.php_cs.dev && test "x$is_dev" = "xtrue"; then
    config_file=./.php_cs.dev
elif test -f ./.php_cs; then
    config_file=./.php_cs
elif test -f ./.php_cs.dist; then
    config_file=./.php_cs.dist
elif test -f ./../.php_cs; then
    config_file=./../.php_cs
elif test -f ~/.php_cs; then
    config_file=~/.php_cs
else
    echo "no config found!"
    return
fi

if test -n "$config_file"; then
    if test "x$1" = "xfix"; then
        if test -z "$2"; then
            $php_cs_fixer_bin -vvv "$@" --config "$config_file"
        else
            $php_cs_fixer_bin "$@"
        fi
    else
        $php_cs_fixer_bin -vvv "$@"
    fi
else
    $php_cs_fixer_bin -vvv "$@"
fi
